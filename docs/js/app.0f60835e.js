(function(t){function e(e){for(var r,o,a=e[0],s=e[1],u=e[2],f=0,h=[];f<a.length;f++)o=a[f],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);c&&c(e);while(h.length)h.shift()();return l.push.apply(l,u||[]),n()}function n(){for(var t,e=0;e<l.length;e++){for(var n=l[e],r=!0,a=1;a<n.length;a++){var s=n[a];0!==i[s]&&(r=!1)}r&&(l.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},i={app:0},l=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],s=a.push.bind(a);a.push=e,a=a.slice();for(var u=0;u<a.length;u++)e(a[u]);var c=s;l.push([1,"chunk-vendors"]),n()})({0:function(t,e){},"030f":function(t,e,n){},"034f":function(t,e,n){"use strict";n("85ec")},"0aa8":function(t,e,n){},1:function(t,e,n){t.exports=n("56d7")},2:function(t,e){},"3e06":function(t,e,n){},"429b":function(t,e,n){"use strict";n("030f")},"478a":function(t,e,n){"use strict";n("0aa8")},"4f49":function(t,e,n){"use strict";n("6a82")},"56d7":function(t,e,n){"use strict";n.r(e);n("a7cc"),n("450d");var r=n("df33"),i=n.n(r),l=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("div"),n("div",{staticStyle:{display:"grid","grid-template-columns":"repeat(2, auto)"}},[n("div",{staticStyle:{display:"grid","grid-template-rows":"repeat(2, auto)","justify-items":"center"}},[n("Table",{attrs:{table:t.table}}),n("ButtonGroup",{attrs:{table:t.table}})],1),n("div",[n("ChartRoom",{ref:"chartRoom",attrs:{user:t.user}})],1)]),t._v(" "+t._s(t.table.id)+" "),n("Dialog",{ref:"dialog"},[n("input",{attrs:{placeholder:"怎么称呼"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitName(e)}}})])],1)},a=[],s=(n("96cf"),n("1da1")),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return void 0!==this.table.boxs?n("div",{staticClass:"table",style:t.tableStyle},t._l(this.table.getBoxs(),(function(t,e){return n("Box",{key:e,attrs:{box:t}})})),1):t._e()},c=[],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{style:t.boxStyle},t._l(t.box.getCells(),(function(t,e){return n("Cell",{key:e,attrs:{cell:t}})})),1)},h=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"cell",style:t.cellStyle,on:{click:function(e){return t.fillGap(e)}}},[n("span",{style:t.valueStyle},[t._v(t._s(t.cell.value)+" ")])])},v=[],p=(n("99af"),n("b0c0"),n("7db0"),n("d81d"),n("d148")),g=n("48e8"),b=g.Realtime,m=n("356c"),y=new b({appId:"gOmqUStGjqpV2o8oMJpeq2qD-gzGzoHsz",appKey:"fv1R6bFH7HBEGpIbYjhVRf0I",server:"https://gomqustg.lc-cn-n1-shared.com"});m.init({appId:"gOmqUStGjqpV2o8oMJpeq2qD-gzGzoHsz",appKey:"fv1R6bFH7HBEGpIbYjhVRf0I",serverURL:"https://gomqustg.lc-cn-n1-shared.com"});var x=p["a"].init({env:"myth-8ghne7lfb3b2968a"}),w=x.database();function k(t){var e=y.createIMClient(t);return e}function C(t){var e=t.getQuery().equalTo("tr",!0);return e.find()}function j(t,e){S().then((function(n){var r=n.data[0]._id;w.collection("Table").doc(r).set({code:t,data:{cells:e.getCells().map((function(t){return{x:t.x,y:t.y,value:t.value,needFill:t.needFill}}))}}).then((function(t){console.log(t),console.log("生成新的table成功")}))}))}function S(){return w.collection("Table").where({}).get()}function O(t){var e=t.remoteTable;w.collection("Table").doc(e._id).update({data:{cells:t.getCells().map((function(t){return{x:t.x,y:t.y,value:t.value,needFill:t.needFill}}))}}).then((function(t){console.log(t)}))}function _(t,e){var n=t.remoteTable;t.watcher=w.collection("Table").doc(n._id).watch({onChange:function(){e(this.virtualClient.sessionInfo.currentDocs[0])}})}var $={props:["cell"],methods:{fillGap:function(t){var e=this;if(!1!==this.cell.allowFill&&!1!==this.cell.needFill){this.$parent.$parent.$parent.$emit("startGame");var n=this.$root.$children[0].user;"×"===this.$root.curIndex?(this.cell.value=void 0,O(this.cell.table),n.sendMsg("[".concat(n.name,"] 将 x:").concat(this.cell.x,",y:").concat(this.cell.y," 清空了"))):this.cell.value=this.$root.curIndex;var r=this.cell.table.verify(this.cell);if(r)this.$root.$children[0],O(this.cell.table),n.sendMsg("[".concat(n.name,"] 将 x:").concat(this.cell.x,",y:").concat(this.cell.y," 修改为:").concat(this.cell.value)),this.cell.table.verifyPass()&&(window.clearInterval(this.$parent.$parent.$parent.timeId),n.sendMsg("[".concat(n.name,"] 下完了最后一步，重新开始")),this.$root.$children[0].restart(),alert("恭喜你通关了"));else{this.cell.value=void 0;var i=t.target.style.background;t.target.style.background="#eb2d2d46",this.cell.allowFill=!1,setTimeout((function(){t.target.style.background=i,e.cell.allowFill=!0}),500)}}}},computed:{valueStyle:function(){return this.cell.needFill?{color:"green","font-size":"35px"}:{"font-size":"25px"}},hint:function(){return this.cell.value===this.$root.curIndex},cellStyle:function(){return this.hint?{background:"#0000004f",color:"#fff"}:{}}}},E=$,M=(n("ca81"),n("2877")),I=Object(M["a"])(E,d,v,!1,null,"106483f4",null),R=I.exports,B={props:["box"],components:{Cell:R},computed:{boxStyle:function(){return{display:"grid","grid-template-columns":"repeat(3, 50px)","grid-template-rows":"repeat(3, 50px)",border:"2px solid #000"}}}},T=B,P=Object(M["a"])(T,f,h,!1,null,null,null),F=P.exports,G={props:["table"],components:{Box:F},data:function(){return{curIndex:"1"}},computed:{tableStyle:function(){return{cursor:'url("./images/'+this.$root.curIndex+'.png") 1 1, auto'}}},mounted:function(){console.log()}},L=G,q=(n("429b"),Object(M["a"])(L,u,c,!1,null,"12d28948",null)),z=q.exports,V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"margin-top":"20px"}},t._l(t.buttons,(function(e,r){return n("button",{key:r,class:t.$root.curIndex===e.label?"btn-handle btn-handle-active":"btn-handle",on:{click:function(n){return t.click(e)}}},[t._v(" "+t._s(e.label)+" ")])})),0)},H=[],A=(n("4de4"),n("4160"),n("159b"),{props:["table"],data:function(){return{buttons:[{label:"1"},{label:"2"},{label:"3"},{label:"4"},{label:"5"},{label:"6"},{label:"7"},{label:"8"},{label:"9"},{label:"×"}]}},methods:{click:function(t){this.$root.curIndex=t.label,this.table.getCells().filter((function(e){return e.hint=!1,e.value===t.label})).forEach((function(t){t.hint=!0}))}}}),D=A,J=(n("478a"),Object(M["a"])(D,V,H,!1,null,"7eff32d2",null)),N=J.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msg,expression:"msg"}],ref:"textarea",staticStyle:{width:"300px",height:"468px","margin-top":"30px"},attrs:{readonly:""},domProps:{value:t.msg},on:{input:function(e){e.target.composing||(t.msg=e.target.value)}}}),n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.willSendMsg,expression:"willSendMsg"}],domProps:{value:t.willSendMsg},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)},input:function(e){e.target.composing||(t.willSendMsg=e.target.value)}}})])])},K=[],W=(n("a15b"),n("48e8")),Y=W.Event,Q={props:["user"],computed:{msg:function(){return this.msgList.join("\n")}},data:function(){return{msgList:[],willSendMsg:""}},methods:{onEnter:function(){var t=this;this.user.sendMsg(this.user.name+":"+this.willSendMsg).then((function(){t.willSendMsg="",t.setScrollLastPositon()}))},startListen:function(){var t=this;this.user.data.on(Y.MESSAGE,(function(e){t.msgList.push(e.text),t.setScrollLastPositon()}))},setScrollLastPositon:function(){this.$refs.textarea.scrollTop=this.$refs.textarea.scrollHeight}},mounted:function(){}},X=Q,Z=(n("5f82"),Object(M["a"])(X,U,K,!1,null,null,null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:"请问",visible:t.dialogVisible,width:"300px","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"custom-dialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[t._t("default"),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],2)},nt=[],rt={data:function(){return{dialogVisible:!0}}},it=rt,lt=(n("4f49"),Object(M["a"])(it,et,nt,!1,null,null,null)),ot=lt.exports,at=(n("ac1f"),n("1276"),n("b85c")),st=n("2ef0"),ut=n.n(st),ct=n("d4ec"),ft=n("bee2"),ht=function(){function t(e,n,r,i,l){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(ct["a"])(this,t),this.x=n,this.y=r,this.box=i,this.weights=100,this.value=void 0===e?void 0:String(e),this.table=l,this.needFill=o,this.hint=!1,this.allowFill=!0}return Object(ft["a"])(t,[{key:"setBlank",value:function(){var t=this;this.value=void 0,this.box.getCells().filter((function(t){return void 0!==t.value})).forEach((function(t){return t.weights=t.weights-1})),this.table.getCells().filter((function(e){return e.x===t.x&&void 0!==e.value})).forEach((function(t){return t.weights=t.weights-1})),this.table.getCells().filter((function(e){return e.y===t.y&&void 0!==e.value})).forEach((function(t){return t.weights=t.weights-1})),this.needFill=!0}}],[{key:"filterCellsByBoxPosition",value:function(t,e,n){if(t<0||t>2)throw new Error("x不在范围内");if(e<0||e>2)throw new Error("x不在范围内");var r=[];return 0===t?r=n.filter((function(t){return t.x>=0&&t.x<3})):1===t?r=n.filter((function(t){return t.x>2&&t.x<6})):2===t&&(r=n.filter((function(t){return t.x>5&&t.x<=9}))),0===e?r=r.filter((function(t){return t.y>=0&&t.y<3})):1===e?r=r.filter((function(t){return t.y>2&&t.y<6})):2===e&&(r=r.filter((function(t){return t.y>5&&t.y<=9}))),r}}]),t}(),dt=ht,vt=function(){function t(e,n){Object(ct["a"])(this,t),this.x=e,this.y=n,this.cells=[],this.weights=100}return Object(ft["a"])(t,[{key:"addCell",value:function(t){this.cells.push(t)}},{key:"setCells",value:function(t){var e=this;t.forEach((function(t){t.box=e})),this.cells=t}},{key:"getCells",value:function(){return this.cells}}]),t}(),pt=vt,gt=function(){function t(){Object(ct["a"])(this,t),this.boxs=[]}return Object(ft["a"])(t,[{key:"addBox",value:function(t){this.boxs.push(t)}},{key:"getBoxs",value:function(){return this.boxs}},{key:"getCells",value:function(){var t=this;if(void 0!==this.cells)return this.cells;var e=[];return this.boxs.forEach((function(t){e=e.concat(t.getCells())})),this.cells=e,this.positionMap={},this.cells.forEach((function(e){t.positionMap[String(e.x)+String(e.y)]=e})),e}},{key:"findCellByPosition",value:function(t){return this.positionMap[t]}},{key:"getMaxWeightsCell",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.getCells().filter((function(t){return void 0!==t.value}));if(e.sort((function(t,e){return t.weights>e.weights?-1:1})),0==t)return e[0];t>e.length-1&&(t=e.length-1);var n=ut.a.random(0,t,!1);return e[n]}},{key:"getRowCells",value:function(t){return this.getCells().filter((function(e){return e.x===t}))}},{key:"getColumnCells",value:function(t){return this.getCells().filter((function(e){return e.y===t}))}},{key:"verify",value:function(t){var e,n=t.box,r=n.getCells().filter((function(e){return e.x!==t.x||e.y!==t.y})),i=Object(at["a"])(r);try{for(i.s();!(e=i.n()).done;){var l=e.value;if(l.value===t.value)return!1}}catch(v){i.e(v)}finally{i.f()}var o,a=this.getRowCells(t.x).filter((function(e){return e.x!==t.x||e.y!==t.y})),s=Object(at["a"])(a);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(u.value===t.value)return!1}}catch(v){s.e(v)}finally{s.f()}var c,f=this.getColumnCells(t.y).filter((function(e){return e.x!==t.x||e.y!==t.y})),h=Object(at["a"])(f);try{for(h.s();!(c=h.n()).done;){var d=c.value;if(d.value===t.value)return!1}}catch(v){h.e(v)}finally{h.f()}return!0}},{key:"verifyPass",value:function(){var t,e=this.getCells(),n=Object(at["a"])(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(void 0===r.value)return!1;if(!1===this.verify(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}}]),t}(),bt=gt,mt=[[1,2,3,4,5,6,7,8,9],[4,5,6,7,8,9,1,2,3],[7,8,9,1,2,3,4,5,6],[8,9,1,2,3,4,5,6,7],[2,3,4,5,6,7,8,9,1],[5,6,7,8,9,1,2,3,4],[6,7,8,9,1,2,3,4,5],[9,1,2,3,4,5,6,7,8],[3,4,5,6,7,8,9,1,2]],yt=function(){for(var t=ut.a.cloneDeep(mt),e=[[0,1,2],[3,4,5],[6,7,8]],n=[[0,1,2],[3,4,5],[6,7,8]],r=[],i=0;i<3;i++){var l=e[i],o=ut.a.random(0,2,!1);ut.a.pullAt(l,o),r.push(o);var a=[t[l[1]],t[l[0]]];t[l[0]]=a[0],t[l[1]]=a[1]}for(var s=0;s<3;s++){var u=n[s],c=ut.a.random(0,2,!1);r.push(c),ut.a.pullAt(u,c);var f,h=Object(at["a"])(t);try{for(h.s();!(f=h.n()).done;){var d=f.value,v=[d[u[1]],d[u[0]]];d[u[0]]=v[0],d[u[1]]=v[1]}}catch(w){h.e(w)}finally{h.f()}}for(var p=new bt,g=0;g<3;g++)for(var b=0;b<3;b++)p.addBox(new pt(g,b));for(var m=[],y=function(e){m=m.concat(t[e].map((function(t,n){return new dt(t,e,n,void 0,p)})))},x=0;x<t.length;x++)y(x);return p.getBoxs().forEach((function(t){var e=dt.filterCellsByBoxPosition(t.x,t.y,m);t.setCells(e)})),{table:p,codeArr:r}},xt=function(t){var e=t.data.cells,n=new bt;n.code=t.code,n.remoteTable=t;for(var r=0;r<3;r++)for(var i=0;i<3;i++)n.addBox(new pt(r,i));var l=e.map((function(t){return new dt(t.value,t.x,t.y,void 0,n,t.needFill)}));return n.getBoxs().forEach((function(t){var e=dt.filterCellsByBoxPosition(t.x,t.y,l);t.setCells(e)})),n},wt=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:49,e=yt(),n=e.table,r=e.codeArr,i=0;i<t;i++){var l=n.getMaxWeightsCell(5);r.push(String(l.x)+String(l.y)),l.setBlank()}var o=r.join("");return j(o,n),{data:n,code:o}},kt=n("48e8"),Ct=kt.TextMessage,jt=function(){function t(e){Object(ct["a"])(this,t),this.name=e}return Object(ft["a"])(t,[{key:"login",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,k(this.name);case 2:this.data=t.sent;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"joinChartRoom",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("开始加入聊天室"),t.next=3,C(this.data);case 3:return n=t.sent,n=n[0],t.next=7,this.getConversation(n);case 7:this.conversation=t.sent,this.msgList=e,this.conversation.join().then((function(){r.sendMsg("欢迎["+r.name+"]光临")}));case 10:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getConversation",value:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.data.getConversation(e.id));case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"sendMsg",value:function(t){return this.msgList.push(t),this.conversation.send(new Ct(t))}}]),t}(),St=jt,Ot={name:"App",components:{Table:z,ButtonGroup:N,ChartRoom:tt,Dialog:ot},data:function(){return{table:{},fillSum:49,gameTime:0,timeId:void 0,user:void 0}},methods:{restart:function(){var t=this;console.log("重开了"),this.fillSum<10||this.fillSum>80?alert("你别玩了"):/^\d+$/.test(this.fillSum)?(this.gameTime=0,this.table=wt(this.fillSum),this.$once("startGame",(function(){t.timeId=setInterval((function(){t.gameTime++}),1e3)}))):alert("输个阳间数")},submitName:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.target.value,r){n.next=3;break}return n.abrupt("return");case 3:return e.$refs.dialog.dialogVisible=!1,e.user=new St(r),n.next=7,e.user.login();case 7:e.user.joinChartRoom(e.$refs.chartRoom.msgList),e.$refs.chartRoom.startListen();case 9:case"end":return n.stop()}}),n)})))()},initTable:function(){var t=this;S().then((function(e){t.table=xt(e.data[0]),_(t.table,(function(e){t.table=xt(e)}))}))}},mounted:function(){var t=this;this.$once("startGame",(function(){t.timeId=setInterval((function(){t.gameTime++}),1e3)})),this.initTable()}},_t=Ot,$t=(n("034f"),n("a5db"),Object(M["a"])(_t,o,a,!1,null,"1f516957",null)),Et=$t.exports;l["default"].use(i.a),l["default"].config.productionTip=!1,new l["default"]({render:function(t){return t(Et)},data:{curIndex:"1"}}).$mount("#app")},"5f82":function(t,e,n){"use strict";n("3e06")},"6a82":function(t,e,n){},"85ec":function(t,e,n){},"8f6f":function(t,e,n){},a5db:function(t,e,n){"use strict";n("b7ff")},b7ff:function(t,e,n){},ca81:function(t,e,n){"use strict";n("8f6f")}});
//# sourceMappingURL=app.0f60835e.js.map